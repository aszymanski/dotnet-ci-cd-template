name: Deploy Azure WebApp

inputs:
  resource_group:
    required: true
  publish_output_path:
    required: true
  web_app_name:
    required: true
  artifact_name:
    required: true
  azure_credentials:
    required: true

runs:
  using: "composite"
  steps:
  - name: Download Artifact
    uses: actions/download-artifact@v2
    with:
      name: ${{ env.artifact_name }}
      path: ${{ env.publish_output_path }}
      
  - name: Zip package
    run: | 
      cd ${{ inputs.publish_output_path }}
      zip -r ./${{ inputs.artifact_name }} .
      ls        

  - name: Login to Azure
    uses: azure/login@v1
    with:
      creds: '${{ inputs.azure_credentials }}'

  - name: Deploy to QA
    run: |
      az webapp deployment source config-zip --resource-group ${{ inputs.resource_group }} --name ${{ inputs.web_app_name }} --src ${{ inputs.publish_output_path }}/${{ inputs.artifact_name }}.zip
